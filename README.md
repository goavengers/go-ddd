# Go-DDD: Domain Driven Design, SAGA, Event-Sourcing & CQRS

## –ù–µ–º–Ω–æ–≥–æ —Ç–µ–æ—Ä–∏–∏

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û ‚Äì —ç—Ç–æ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, –æ–±–ª–∞–∫–∞, –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç ‚Äì –≤—Å–µ —ç—Ç–æ —Å—Ç–∞–ª–æ –Ω–æ—Ä–º–æ–π. –ù–æ –∑–∞ –∫—Ä–∞—Å–∏–≤—ã–º–∏ –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ –∏ –º–æ–¥–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å. –ö–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∫—É—á—É —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ –Ω–∞–¥–µ–∂–Ω–æ? –ö–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, —Ä–∞–∑–º–∞–∑–∞–Ω–Ω—ã–µ –ø–æ —Å–µ—Ç–∏, –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏? –≠—Ç–∞ –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –∑–Ω–∞–∫–æ–º–∞ –ª—é–±–æ–º—É, –∫—Ç–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª —Å–∏—Å—Ç–µ–º—ã —Å–ª–æ–∂–Ω–µ–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, –±—É–¥—å —Ç–æ –≤ —Ç—Ä–µ–±–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º —Ñ–∏–Ω—Ç–µ—Ö–µ, –¥–∏–Ω–∞–º–∏—á–Ω–æ–º e-commerce –∏–ª–∏ –≥–¥–µ-–ª–∏–±–æ –µ—â–µ.

–ò –≤–æ—Ç —Ç—É—Ç –Ω–∞ –ø–æ–º–æ—â—å (–∏–ª–∏, —Å–∫–æ—Ä–µ–µ, –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è –±–æ—è) –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç—Ä–∏ –ø–æ–Ω—è—Ç–∏—è: ACID, BASE –∏ —Ç–µ–æ—Ä–µ–º–∞ CAP. –ú–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ —Å—É—Ö–∞—è —Ç–µ–æ—Ä–∏—è, –Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Ö ‚Äì –≤—Å–µ —Ä–∞–≤–Ω–æ —á—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç—å –≤ –º–æ—Ä–µ –±–µ–∑ –∫–æ–º–ø–∞—Å–∞ –∏ –∫–∞—Ä—Ç—ã. –≠—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏–º–µ—Ç—å –¥–µ–ª–æ –∫–∞–∂–¥–æ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É. –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∏—Ö ‚Äì –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è —É—Å–ø–µ—Ö–∞, –Ω–æ –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ —É—Å–ª–æ–≤–∏–µ.

### –ù–µ–∑—ã–±–ª–µ–º—ã–π ACID: –ö–ª–∞—Å—Å–∏–∫–∞ –∂–∞–Ω—Ä–∞ (–∏ –µ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

–ù–∞—á–Ω–µ–º —Å–æ —Å—Ç–æ–ª–ø–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è–º–∏ –¥–µ—Ä–∂–∞–ª–∏—Å—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. **–ß—Ç–æ –∂–µ –æ–±–µ—â–∞–µ—Ç –Ω–∞–º ACID? –ü–æ —Å—É—Ç–∏, —ç—Ç–æ —á–µ—Ç—ã—Ä–µ —Å—Ç–æ–ª–ø–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–æ–∏–ª–∞—Å—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:**

- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (Atomicity):** –í—Å–µ –ø—Ä–æ—Å—Ç–æ ‚Äì –ª–∏–±–æ –≤—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ, –ª–∏–±–æ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫, —Å–ª–æ–≤–Ω–æ –µ–µ –∏ –Ω–µ –∑–∞—Ç–µ–≤–∞–ª–∏. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥: —Å–ø–∏—Å–∞–ª–∏ —Ç—É—Ç, –∑–∞—á–∏—Å–ª–∏–ª–∏ —Ç–∞–º. –ù–µ–ª—å–∑—è –∑–∞—Å—Ç—Ä—è—Ç—å –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ. ACID –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ—Ç —ç—Ç–æ "–≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ".
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (Consistency):** –¢—É—Ç –≤–∞–∂–Ω–æ –Ω–µ –ø—É—Ç–∞—Ç—å —Å 'C' –∏–∑ CAP! –í ACID —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞—Ä—É—à–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤–∞–º–∏ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã ‚Äì –≤—Å—è–∫–∏—Ö —Ç–∞–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏. –ë–∞–ª–∞–Ω—Å –Ω–µ —É–π–¥–µ—Ç –≤ –º–∏–Ω—É—Å, –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è. –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –ª–æ–≥–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (Isolation):** –ú–∏—Ä –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ª–µ—Ç—è—Ç –ø–∞—á–∫–∞–º–∏. –ò–∑–æ–ª—è—Ü–∏—è ‚Äì —ç—Ç–æ —â–∏—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–∞–µ—Ç –∏–º –Ω–∞—Å—Ç—É–ø–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É –Ω–∞ –ø—è—Ç–∫–∏ –∏ –≤–∏–¥–µ—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π '–±–µ—Å–ø–æ—Ä—è–¥–æ–∫' –¥—Ä—É–≥ –¥—Ä—É–≥–∞. –í –∏–¥–µ–∞–ª–µ (—É—Ä–æ–≤–µ–Ω—å Serializable) –≤—Å–µ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫, –±—É–¥—Ç–æ –æ–Ω–∏ –∏–¥—É—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ –æ—á–µ—Ä–µ–¥–∏. –ù–∞ –¥–µ–ª–µ –º—ã —á–∞—Å—Ç–æ –∏–¥–µ–º –Ω–∞ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–ø—Ä–æ—â–µ) —Ä–∞–¥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ —Ü–µ–ª—å ‚Äì –Ω–µ –¥–∞—Ç—å –∏–º —Å–º–µ—à–∞—Ç—å –∫–∞—Ä—Ç—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É.
- **–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å (Durability):** –°–∫–∞–∑–∞–Ω–æ ‚Äì —Å–¥–µ–ª–∞–Ω–æ, –∏ —Ç–æ—á–∫–∞. –ï—Å–ª–∏ –±–∞–∑–∞ –æ—Ç—á–∏—Ç–∞–ª–∞—Å—å –æ–± —É—Å–ø–µ—Ö–µ, –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É, —Å–±–æ–π –ø–∏—Ç–∞–Ω–∏—è ‚Äì —á—Ç–æ —É–≥–æ–¥–Ω–æ, –∫—Ä–æ–º–µ —Å–æ–≤—Å–µ–º —É–∂ –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞ –≤—Ä–æ–¥–µ –ø–æ–∂–∞—Ä–∞ –≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π. –ó–∞–ø–∏—Å—å –Ω–∞–¥–µ–∂–Ω–∞.

ACID ‚Äì —ç—Ç–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ. –≠—Ç–æ –∫–∞–∫ —Å–µ–π—Ñ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö. –ù–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å—Ç—è–Ω—É—Ç—å —ç—Ç–æ—Ç —Å–µ–π—Ñ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç (—Å–µ—Ä–≤–µ—Ä–æ–≤), —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∏–¥–æ—Ä–∞–º–∏ (—Å–µ—Ç—å—é). –û–±–µ—Å–ø–µ—á–∏—Ç—å —Ç—É –∂–µ –Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º–æ—Å—Ç—å –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä—Ç–æ–≤—Å–∫–∏ —Å–ª–æ–∂–Ω–æ. –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –≤—Ä–æ–¥–µ –¥–≤—É—Ö—Ñ–∞–∑–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ (2PC), –∫–æ—Ç–æ—Ä—ã–µ –ø—ã—Ç–∞—é—Ç—Å—è —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, —Ç—Ä–µ–±—É—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤–æ –≤—Å–µ—Ö —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö "–∫–æ–º–Ω–∞—Ç–∞—Ö". –ï—Å–ª–∏ –æ–¥–Ω–∞ –∫–æ–º–Ω–∞—Ç–∞ –∑–∞–¥—É–º–∞–ª–∞—Å—å –∏–ª–∏ –∫–æ—Ä–∏–¥–æ—Ä –∫ –Ω–µ–π –ø–µ—Ä–µ–∫—Ä—ã–ª–∏ ‚Äì –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –≤—Å—Ç–∞–µ—Ç. –≠—Ç–æ –±—å–µ—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—Ç—É—Ç) –∏, –≥–ª–∞–≤–Ω–æ–µ, –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã. –¶–µ–Ω–∞ –∑–∞ —Å—Ç—Ä–æ–≥–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π ACID —á–∞—Å—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ–π.

### –¢–µ–æ—Ä–µ–º–∞ CAP: –ñ–µ—Å—Ç–∫–∞—è –¥–∏–ª–µ–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∫–∏

–°—Ç–æ–ª–∫–Ω—É–≤—à–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ ACID, –∏–Ω–¥—É—Å—Ç—Ä–∏—è –æ–±—Ä–∞—Ç–∏–ª–∞—Å—å –∫ —Ç–µ–æ—Ä–µ–º–µ CAP. –û–Ω–∞ —Å—Ç–∞–ª–∞ —á–µ–º-—Ç–æ –≤—Ä–æ–¥–µ –∑–∞–∫–æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ò –Ω–µ—Ç, —ç—Ç–æ –Ω–µ "–≤—ã–±–µ—Ä–∏ –¥–≤–∞ –∏–∑ —Ç—Ä–µ—Ö", –∫–∞–∫ —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä—è—Ç. –í—Å–µ –Ω–µ–º–Ω–æ–≥–æ —Ö–∏—Ç—Ä–µ–µ. –¢–µ–æ—Ä–µ–º–∞ –æ–ø–µ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–µ–º—è —Å–≤–æ–π—Å—Ç–≤–∞–º–∏:

- –¢—É—Ç **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (Consistency)** ‚Äì —ç—Ç–æ –ø—Ä–æ –¥—Ä—É–≥–æ–µ, —ç—Ç–æ —Ö–∞—Ä–¥–∫–æ—Ä. –≠—Ç–æ –∫–æ–≥–¥–∞ –ª—é–±–æ–µ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—É–¥–∞ —É–≥–æ–¥–Ω–æ –≤—ã–¥–∞–µ—Ç —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π, —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ö–∞–∫ –±—É–¥—Ç–æ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ –æ–¥–∏–Ω –Ω–∞ –≤—Å–µ—Ö, –∏ –≤—Å–µ –≤–∏–¥—è—Ç –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (Availability)** ‚Äì –∑–Ω–∞—á–∏—Ç, —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ —Å–≤—è–∑–∏. –í—ã —Å—Ç—É—á–∏—Ç–µ—Å—å –≤ –ª—é–±–æ–π –∂–∏–≤–æ–π —É–∑–µ–ª ‚Äì –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –∞ –Ω–µ –æ—à–∏–±–∫–æ–π "–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ". –û–Ω –º–æ–∂–µ—Ç –æ—Ç–¥–∞—Ç—å –Ω–µ —Å–∞–º—ã–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –æ–Ω –æ—Ç–≤–µ—á–∞–µ—Ç.
- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é (Partition Tolerance)** ‚Äì —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–∂–∏—Ç—å —Ä–∞—Å–∫–æ–ª —Å–µ—Ç–∏, –∫–æ–≥–¥–∞ —É–∑–ª—ã —Ç–µ—Ä—è—é—Ç —Å–≤—è–∑—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º. –ò –≤–æ—Ç —Ç—É—Ç –∑–∞–≥–≤–æ–∑–¥–∫–∞, —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –≤—ã–≤–æ–¥ –∏–∑ CAP: —ç—Ç–æ—Ç —Ä–∞—Å–∫–æ–ª —Å–µ—Ç–∏ (P) ‚Äì –Ω–µ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—à–∏–ª–∫–∞, –∞ –Ω–µ–∏–∑–±–µ–∂–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –ª—é–±–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –°–µ—Ç—å –±—É–¥–µ—Ç "–º–æ—Ä–≥–∞—Ç—å", –∏ —Å —ç—Ç–∏–º –Ω–∞–¥–æ –∂–∏—Ç—å.

–ò –≤–æ—Ç —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç —Ç–µ–æ—Ä–µ–º–∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ: **–∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ—Ç–µ–≤–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (P), —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –ª–∏–±–æ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é (C), –ª–∏–±–æ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é (A)**. –ù–µ–ª—å–∑—è –∏–º–µ—Ç—å –∏ —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** –≤ –º–æ–º–µ–Ω—Ç —Ä–∞–∑—Ä—ã–≤–∞ —Å–≤—è–∑–∏.

- **–í—ã–±–∏—Ä–∞–µ—Ç–µ CP (Consistency –Ω–∞–¥ Availability):** –í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ —Ü–µ–Ω–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ —É–∑–µ–ª –∏–∑-–∑–∞ —Ä–∞–∑–¥–µ–ª–∞ —Å–µ—Ç–∏ –Ω–µ –º–æ–∂–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤–∏–¥–∏—Ç —Å–∞–º—É—é —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —á—Ç–æ –µ–≥–æ –∑–∞–ø–∏—Å—å —É–≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ, –æ–Ω –ø—Ä–µ–¥–ø–æ—á—Ç–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å –≤–æ–≤—Å–µ, –ª–∏—à—å –±—ã –Ω–µ –Ω–∞—Ä—É—à–∏—Ç—å –ª–∏–Ω–µ–∞—Ä–∏–∑—É–µ–º–æ—Å—Ç—å. –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –≥–∞—Ä–∞–Ω—Ç–∏—é C —Ü–µ–Ω–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –≤–æ –≤—Ä–µ–º—è P.
- **–í—ã–±–∏—Ä–∞–µ—Ç–µ AP (Availability –Ω–∞–¥ Consistency):** –í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ —Ü–µ–Ω–∏—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –î–∞–∂–µ –µ—Å–ª–∏ —É–∑–µ–ª –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω —Ä–∞–∑–¥–µ–ª–æ–º, –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö) –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ (–∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –ø—Ä–∏–¥–µ—Ç—Å—è –∫–∞–∫-—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å). –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –≥–∞—Ä–∞–Ω—Ç–∏—é A —Ü–µ–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π (–∏–ª–∏ –¥–∞–∂–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å) —Ä–∞—Å—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ —Å–∏—Å—Ç–µ–º—ã –≤–æ –≤—Ä–µ–º—è P.

–ê —á—Ç–æ –∂–µ —Å–∏—Å—Ç–µ–º—ã CA (Consistency + Availability)? –û–Ω–∏ –≤–æ–∑–º–æ–∂–Ω—ã –ª–∏—à—å –≤ –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–æ–º –º–∏—Ä–µ –±–µ–∑ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º. –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Å–ª—É—á–∞–µ—Ç—Å—è P, –ª—é–±–∞—è CA-—Å–∏—Å—Ç–µ–º–∞ –≤—ã–Ω—É–∂–¥–µ–Ω–∞ –±—É–¥–µ—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞—Ç—å –ª–∏–±–æ –¥–æ CP, –ª–∏–±–æ –¥–æ AP.

### BASE: –ü—Ä–∞–≥–º–∞—Ç–∏–∑–º –≤ –º–∏—Ä–µ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞

–ò—Ç–∞–∫, –µ—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é P –∏ –≤—ã–±—Ä–∞–ª–∏ A (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å), –≤—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∫ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º, –æ–ø–∏—Å—ã–≤–∞–µ–º—ã–º –∞–∫—Ä–æ–Ω–∏–º–æ–º BASE. –≠—Ç–æ –Ω–µ —Å—Ç—Ä–æ–≥–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –∞ —Å–∫–æ—Ä–µ–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —É—Å–ª–æ–≤–∏—è—Ö —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤ –∏ –Ω–µ—Å—Ç—Ä–æ–≥–æ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏:

- **Basically Available (–ë–∞–∑–æ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å):** –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–∞–∫ –∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –≤—ã–±–æ—Ä 'A' –≤ CAP. –ú–æ–∂–µ—Ç –±—ã—Ç—å, –Ω–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ "–∂–∏–≤–∞".
- **Soft state (–ì–∏–±–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):** –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –¥–∞–∂–µ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —É–∑–ª—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –ø—ã—Ç–∞—é—Ç—Å—è –ø—Ä–∏–π—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∫—ç—à–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
- **Eventually consistent (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ–Ω–µ—á–Ω–æ–º —Å—á–µ—Ç–µ):** –°–∞–º—ã–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏ —á–∞—Å—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞–µ–º—ã–π –ø—Ä–∏–Ω—Ü–∏–ø BASE. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –≤—Å–µ —É–∑–ª—ã —É–≤–∏–¥—è—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ù–æ –æ–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ –Ω–µ –ø–æ—Å—Ç—É–ø–∞–µ—Ç, —Ç–æ —Ä–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏ —ç—Ç–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Å–æ–π–¥—É—Ç—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é. "–†–∞–Ω–æ –∏–ª–∏ –ø–æ–∑–¥–Ω–æ" ‚Äì –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, —Å–µ–∫—É–Ω–¥—ã –∏–ª–∏ –¥–∞–∂–µ –º–∏–Ω—É—Ç—ã, –∏ —ç—Ç–æ –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–∞–∫-—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∏–ª–∏ —Ö–æ—Ç—è –±—ã –Ω–∞–±–ª—é–¥–∞–µ–º–æ.

BASE ‚Äì —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –≤–æ –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞—è—Ö –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–µ –Ω—É–∂–Ω–∞ –∏ –µ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ ‚Äì –∑–¥–µ—Å—å –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–∞—Å—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–∞. –≠—Ç–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –ø—Ä–∏–Ω–∏–º–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–±–∏—Ä–∞–µ–º—Å—è. –ù–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å: —Ä–∞–±–æ—Ç–∞—Ç—å —Å eventually consistent –¥–∞–Ω–Ω—ã–º–∏ —Å–ª–æ–∂–Ω–µ–µ, –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏ —á—Ç–µ–Ω–∏—è (–ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –Ω–æ–≤—ã—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä).

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–∞–∫ –∏—Å–∫—É—Å—Å—Ç–≤–æ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞: –ü—Ä–∏–º–µ–Ω—è–µ–º ACID/BASE/CAP

–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö —Ç—Ä–µ—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π ‚Äì —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ. –ù–∞—Å—Ç–æ—è—â–∞—è —Ä–∞–±–æ—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ ‚Äì –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π:

1. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è ‚Äì –≤–æ –≥–ª–∞–≤–µ —É–≥–ª–∞:** –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å –≤–æ–ø—Ä–æ—Å–∞ "–ß—Ç–æ –Ω—É–∂–Ω–æ –±–∏–∑–Ω–µ—Å—É –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?". –ù–∞—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ—Ç–µ—Ä—è –∏–ª–∏ —Ä–∞—Å—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —ç—Ç–∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö? –ö–∞–∫–æ–≤–∞ —Ü–µ–Ω–∞ –æ—à–∏–±–∫–∏? –ö–∞–∫–æ–≤—ã –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞? –û—Ç–≤–µ—Ç—ã –Ω–∞ —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω—É–∂–Ω–∞ –ª–∏ –≤–∞–º –∫—Ä–µ–ø–æ—Å—Ç—å ACID –∏–ª–∏ –≥–∏–±–∫–æ—Å—Ç—å BASE –¥–ª—è –¥–∞–Ω–Ω–æ–π —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã. –ò —É–º–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è CAP –Ω–∞ —è–∑—ã–∫ –±–∏–∑–Ω–µ—Å-—Ä–∏—Å–∫–æ–≤ ‚Äì –≤–∞–∂–Ω—ã–π –Ω–∞–≤—ã–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞.
2. **–í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:** –†–µ—à–µ–Ω–∏–µ –æ –°–£–ë–î, –±—Ä–æ–∫–µ—Ä–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫—ç—à–µ ‚Äì —ç—Ç–æ –≤–æ –º–Ω–æ–≥–æ–º —Ä–µ—à–µ–Ω–∏–µ –æ –º–æ–¥–µ–ª–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
   - **–†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –°–£–ë–î (Postgres, etc.):** –û–±—ã—á–Ω–æ –≤–∞—à –≤—ã–±–æ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–µ–±—É—é—â–∏—Ö —Å—Ç—Ä–æ–≥–æ–≥–æ ACID. –í –∫–ª–∞—Å—Ç–µ—Ä–µ —á–∞—Å—Ç–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ CP.
   - **NoSQL:** –ó–¥–µ—Å—å —Ü–∞—Ä–∏—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ. Cassandra –∏ Riak —Å–ª–∞–≤—è—Ç—Å—è —Å–≤–æ–µ–π AP-–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π. MongoDB –∏ Couchbase –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –≥–∏–±–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏. Key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ç–∏–ø–∞ Redis —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (AP). –í–∞–∂–Ω–æ —á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äì –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –°–£–ë–î –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–≤–æ—Ä—É–º–æ–≤ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –≤ Cassandra –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∞–ª–∞–Ω—Å C –∏ A.
3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:** –ú–Ω–æ–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚Äì —ç—Ç–æ, –ø–æ —Å—É—Ç–∏, —Å–ø–æ—Å–æ–±—ã –æ–±–æ–π—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω—É–∂–Ω—É—é –º–æ–¥–µ–ª—å –ø–æ–≤–µ–¥–µ–Ω–∏—è:
   - **Saga:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏, —Ä–∞–∑–±–∏–≤–∞—è –∏—Ö –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è–º–∏. –≠—Ç–æ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∏—á—å –±–∏–∑–Ω–µ—Å-–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ —Ç–∞–º, –≥–¥–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π ACID (2PC) –Ω–µ–ø—Ä–∞–∫—Ç–∏—á–µ–Ω –∏–∑-–∑–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.
   - **CQRS:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –¥–ª—è –∫–æ–º–∞–Ω–¥ (–∑–∞–ø–∏—Å—å) –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (—á—Ç–µ–Ω–∏–µ). –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é, –≤–æ–∑–º–æ–∂–Ω–æ, eventually consistent –º–æ–¥–µ–ª—å –¥–ª—è —á—Ç–µ–Ω–∏—è. –≠—Ç–æ –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è —á–∞—Å—Ç–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.
   - **Event Sourcing:** –ó–∞–ø–∏—Å—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞–∫ —Å–æ–±—ã—Ç–∏–π. –û—Ç–ª–∏—á–Ω–æ –ª–æ–∂–∏—Ç—Å—è –Ω–∞ CQRS –∏ –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ eventually consistent –ø—Ä–æ–µ–∫—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ –∞–Ω–∞–ª–∏–∑ –∏ –æ—Ç–ª–∞–¥–∫—É.
   - **–û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (Kafka, RabbitMQ):** –°–µ—Ä–¥—Ü–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π, —Å–ª–∞–±–æ—Å–≤—è–∑–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (AP/BASE). –ü–æ–∑–≤–æ–ª—è—é—Ç —Å–µ—Ä–≤–∏—Å–∞–º –æ–±—â–∞—Ç—å—Å—è –Ω–∞–¥–µ–∂–Ω–æ, –Ω–æ –±–µ–∑ –ø—Ä—è–º—ã—Ö –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤, —Å–≥–ª–∞–∂–∏–≤–∞—è –ø–∏–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è eventual consistency. –í–∞–∂–Ω–æ —Ç–∞–∫–∂–µ –¥—É–º–∞—Ç—å –æ–± –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.
4. **–ñ–∏–∑–Ω—å —Å Partition Tolerance:** –ù—É–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞—Ç—å CP/AP, –Ω–æ –∏ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ –º–æ–≥–ª–∞ –ø–µ—Ä–µ–∂–∏—Ç—å P. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:
   - –ù–∞–¥–µ–∂–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–∑–ª–æ–≤ –∏ —Å–µ—Ç–∏.
   - –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–ª—è AP-—Å–∏—Å—Ç–µ–º (–∫—Ç–æ –ø–æ–±–µ–∂–¥–∞–µ—Ç –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏?).
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–µ—Ä–∂–µ–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ BASE-—Å–∏—Å—Ç–µ–º–∞—Ö, —á—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ "—Å—Ç–∞—Ä—ã–º–∏" –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ.
   - –ß–µ—Ç–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ —Å–µ—Ç–∏ –∏–ª–∏ –∞–Ω–æ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫.

### –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä

**ACID, BASE –∏ CAP** ‚Äì —ç—Ç–æ –Ω–µ –¥–æ–≥–º—ã, –∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º—ã—à–ª–µ–Ω–∏—è. –û–Ω–∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç –Ω–µ–∏–∑–±–µ–∂–Ω—ã–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã –≤ —Å–ª–æ–∂–Ω–æ–º –º–∏—Ä–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ù–µ—Ç "—Å–µ—Ä–µ–±—Ä—è–Ω–æ–π –ø—É–ª–∏". –¢–∞–∫ —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ ‚Äì —ç—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –±–∞–ª–∞–Ω—Å–∞. –ò–¥–µ–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π —Ç—É—Ç –Ω–µ—Ç, –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±–æ—Ä –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ä–∞–∑–º–µ–Ω–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏, —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö "—Ö–æ—Ç–µ–ª–æ–∫" –±–∏–∑–Ω–µ—Å–∞, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∞–ª–∏–π –∏ —Ç–æ–≥–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç. –≠—Ç–æ –≤—Å–µ–≥–¥–∞ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å, –∏ –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äì —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º.

## –≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

## –í–≤–µ–¥–µ–Ω–∏–µ

–í—Å–µ, –∫—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, —Ç–∞–∫ –∏–ª–∏ –∏–Ω–∞—á–µ —Ä–µ—à–∞—é—Ç –¥–ª—è —Å–µ–±—è –≤–æ–ø—Ä–æ—Å: –∫–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —É—á–∞—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –†–∞–∑—É–º–µ–µ—Ç—Å—è, –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∞–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –ù–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –º–æ–Ω–æ–ª–∏—Ç–∞ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º –∫–ª—é—á–µ–≤–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –í —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –º—ã –ø—Ä–æ—Å–ª–µ–¥–∏–º —ç–≤–æ–ª—é—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:

1. –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SAGA
2. –£–ª—É—á—à–µ–Ω–Ω–∞—è Event-Driven SAGA
3. –ü–µ—Ä–µ—Ö–æ–¥ –∫ CQRS
4. –í–≤–µ–¥–µ–Ω–∏–µ Event Sourcing
5. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ES+CQRS

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏–∫—É

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤. 
–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç–≤–æ–ª—é—Ü–∏—é —Ä–µ—à–µ–Ω–∏—è –æ—Ç –±–∞–∑–æ–≤–æ–π SAGA –¥–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

## 2. –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SAGA

### –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏–∫–∞
–í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã. SAGA –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.


### 2.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä

<img src="./static/diagrams/saga_0.svg" alt="saga_0_overview">

```graph
graph TD
    A[Client] --> B[Order Service]
    B --> C[Catalog Service]
    B --> D[Payment Service]
```

### 2.2. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ SAGA

<img src="./static/diagrams/saga_1.svg" alt="saga_first_overview">

```sequence
sequenceDiagram
    participant Client
    participant OrderService
    participant CatalogService
    participant PaymentService

    Client->>OrderService: –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (POST /orders)
    OrderService->>CatalogService: –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã (PUT /catalog/reserve)
    CatalogService-->>OrderService: –¢–æ–≤–∞—Ä—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã
    OrderService->>PaymentService: –°–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ (POST /payment/charge)
    PaymentService-->>OrderService: –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω
    OrderService->>Client: –ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
```

### 2.3. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 2.3.1. Order Service

–†–æ–ª—å: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä SAGA, —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∑–∞–∫–∞–∑–∞.

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```go
func (s *OrderService) CreateOrder() error {
    // 1. –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã
    if err := s.catalog.ReserveItems(); err != nil {
        return err
    }
    
    // 2. –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
    if err := s.payment.Charge(); err != nil {
        s.catalog.CancelReservation() // –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
        return err
    }
    
    return nil
}
```

#### 2.3.2. Catalog Service

–†–æ–ª—å: –£–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Å—Ç–∞—Ç–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤.

#### 2.3.3. Payment Service

–†–æ–ª—å: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏.

### 2.4. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—Å—Ç–∏

<img src="./static/diagrams/saga_2.svg" alt="saga_second_overview">

```sequence
sequenceDiagram
    participant OrderService
    participant Kafka
    participant CatalogService
    participant PaymentService

    OrderService->>Kafka: OrderCreated (SAGA_START)
    Kafka->>CatalogService: ReserveItems
    CatalogService->>Kafka: ItemsReserved / ReserveFailed
    Kafka->>PaymentService: ChargePayment (–µ—Å–ª–∏ ReserveSuccess)
    PaymentService->>Kafka: PaymentProcessed / PaymentFailed
    Kafka->>OrderService: SAGA_COMPLETE / SAGA_ROLLBACK
```

### 2.5. –ü—Ä–æ–±–ª–µ–º—ã –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç **–ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
- **–ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ—à–∏–±–∫–∏** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ü–æ—Ç–µ—Ä—è —Å–æ–±—ã—Ç–∏–π** –ø—Ä–∏ —Å–±–æ—è—Ö
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2.6. –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

- –î–æ–±–∞–≤–∏—Ç—å Idempotency Key –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π.
- –í–Ω–µ–¥—Ä–∏—Ç—å Circuit Breaker –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Outbox Pattern –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π.

### 2.7. –í—ã–≤–æ–¥

- ‚úÖ SAGA —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–µ–π —á–∞—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
- ‚ö† –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–ª—É—á—à–µ Event Sourcing + CQRS)

### 2.8. –ì–ª–æ—Å–∞—Ä–∏–π

> ##### –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (SAGA Rollback)
> –ï—Å–ª–∏ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞, —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:
> 1. **–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª** ‚Üí –û—Ç–º–µ–Ω–∞ —Ä–µ–∑–µ—Ä–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ (CatalogService.CancelReservation).
> 2. **–†–µ–∑–µ—Ä–≤ –Ω–µ —É–¥–∞–ª—Å—è** ‚Üí –ó–∞–∫–∞–∑ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è –¥–µ–Ω–µ–≥.


## 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è Event-Driven SAGA

<img src="./static/diagrams/saga_6.svg" alt="saga_6_overview">

```graph
graph LR
    A[Order] -->|Events| B[Kafka]
    B --> C[Catalog]
    B --> D[Payment]
    C --> B
    D --> B
```

> –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Kafka –∏–ª–∏ RabbitMQ:

<img src="./static/diagrams/saga_3.svg" alt="saga_third_overview">

```sequence
sequenceDiagram
    participant Client
    participant OrderService
    participant CatalogService
    participant PaymentService
    participant Kafka
    participant OutboxTable

    Client->>OrderService: POST /orders (idempotency-key: XYZ123)
    OrderService->>OutboxTable: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å OrderCreatedEvent
    OrderService->>Kafka: OrderCreated (SAGA_START)
    Kafka->>CatalogService: ReserveItems (—á–µ—Ä–µ–∑ CB)
    CatalogService->>OutboxTable: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ItemsReservedEvent
    CatalogService->>Kafka: ItemsReserved
    Kafka->>PaymentService: ChargePayment (—á–µ—Ä–µ–∑ CB)
    PaymentService->>OutboxTable: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PaymentProcessedEvent
    PaymentService->>Kafka: PaymentProcessed
    Kafka->>OrderService: SAGA_COMPLETE
```

### 3.1. Idempotency Key (–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

**–ó–∞–¥–∞—á–∞:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.
**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```go
// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
func IdempotencyMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        key := r.Header.Get("Idempotency-Key")
        if cached := cache.Get(key); cached != nil {
            respondWithCached(w, cached)
            return
        }
        next.ServeHTTP(w, r)
    })
}
```

### 3.2. Circuit Breaker (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)

**–ó–∞–¥–∞—á–∞:** –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.
**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```go
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Catalog Service
cb := gobreaker.NewCircuitBreaker(gobreaker.Settings{
    Name:    "CatalogService",
    Timeout: 30 * time.Second,
    ReadyToTrip: func(counts gobreaker.Counts) bool {
        return counts.ConsecutiveFailures > 5
    },
})
```

### 3.3. Outbox Pattern (–ù–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π)

**–ó–∞–¥–∞—á–∞:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–∞–∂–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞.
**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```go
CREATE TABLE outbox (
    id UUID PRIMARY KEY,
    saga_id VARCHAR(255),
    event_type VARCHAR(100),
    payload JSONB,
    created_at TIMESTAMP,
    processed BOOLEAN DEFAULT false
);
```

### 3.4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

<img src="./static/diagrams/saga_4.svg" alt="saga_4_overview">

```graph
graph TD
    A[Client] --> B[Order Service]
    B --> C[Catalog Service]
    B --> D[Payment Service]
    B --> E[(Outbox DB)]
    C --> F[(Catalog DB)]
    D --> G[(Payment DB)]
    B --> H[Kafka]
    C --> H
    D --> H
    H --> I[SAGA Orchestrator]
    I --> B
```

### 3.5. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—Å—Ç–∏

<img src="./static/diagrams/saga_5.svg" alt="saga_5_overview">

```sequence
sequenceDiagram
    participant Client
    participant OrderService
    participant CatalogService
    participant PaymentService
    participant Kafka
    participant OutboxProcessor

    Client->>OrderService: POST /orders
    OrderService->>OrderService: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Idempotency Key
    OrderService->>OrderService: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –≤ –ë–î
    OrderService->>OutboxProcessor: OrderCreated (Outbox)
    OutboxProcessor->>Kafka: OrderCreated
    Kafka->>SagaOrchestrator: OrderCreated
    SagaOrchestrator->>CatalogService: ReserveItems
    CatalogService->>CatalogService: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ
    CatalogService->>CatalogService: –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã
    CatalogService->>OutboxProcessor: ItemsReserved (Outbox)
    OutboxProcessor->>Kafka: ItemsReserved
    Kafka->>SagaOrchestrator: ItemsReserved
    SagaOrchestrator->>PaymentService: ProcessPayment
    PaymentService->>PaymentService: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂
    PaymentService->>OutboxProcessor: PaymentProcessed (Outbox)
    OutboxProcessor->>Kafka: PaymentProcessed
    Kafka->>SagaOrchestrator: PaymentProcessed
    SagaOrchestrator->>OrderService: CompleteOrder
    OrderService->>OrderService: –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
    OrderService->>Client: 200 OK
```

## 4. üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥              | –î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏  |
|---------------------|---|---|
| **–ë–∞–∑–æ–≤–∞—è SAGA**    | –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  | –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è  |
| **–° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏** | –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç  |

## 5. –ü–µ—Ä–µ—Ö–æ–¥ –∫ CQRS –∏ Event Sourcing

### 5.1. CQRS: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

#### 5.1.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

<img src="./static/diagrams/cqrs.svg" alt="cqrs_overview">

```graph
graph TB
    A[Command] --> B[Command Handler]
    B --> C[Event Store]
    C --> D[Read Model]
    E[Query] --> F[Read Model]
```

#### 5.1.2. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```go
package main

// Command Side
type CreateOrderCommand struct {
    UserID uuid.UUID
    Items  []OrderItem
}

type OrderCommandHandler struct {
    eventStore EventStore
}

func (h *OrderCommandHandler) Handle(cmd CreateOrderCommand) error {
    events := []Event{
        NewEvent("OrderCreated", cmd),
    }
    return h.eventStore.Append(events)
}

// Query Side
type OrderReadModel struct {
    db *sql.DB
}

func (r *OrderReadModel) GetByID(id uuid.UUID) (OrderView, error) {
    // Query from optimized read storage
}
```

### 5.2. –ì–ª–æ—Å–∞—Ä–∏–π

> –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è: 
> 
> **Commands** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
> 
> **Queries** - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

Queries - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## 6. Event Sourcing: –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥

### 6.1. –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

**–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** = –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π

```go
type EventStore interface {
    Append(event Event) error
    GetStream(aggregateID string) ([]Event, error)
}

type Event struct {
    ID          uuid.UUID
    Type        string
    AggregateID string
    Data        []byte
    Version     uint64
    Timestamp   time.Time
}
```

### 6.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ç–∞

```go
type OrderAggregate struct {
    ID      uuid.UUID
    Version uint64
    State   OrderState
}

func (a *OrderAggregate) Apply(event Event) error {
    switch event.Type {
    case "OrderCreated":
        var data OrderCreatedData
        json.Unmarshal(event.Data, &data)
        a.State = OrderState{Status: "created"}
    case "PaymentProcessed":
        a.State.Status = "paid"
    }
    a.Version = event.Version
    return nil
}
```

## 7. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥: Event Sourcing + CQRS

### 7.1. –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

<img src="./static/diagrams/es-cqrs.svg" alt="es_cqrs_overview">

```graph
graph LR
    A[Client] --> B[Command]
    B --> C[Command Handler]
    C --> D[Event Store]
    D --> E[Event Processor]
    E --> F[Read Model]
    A --> G[Query]
    G --> F
    E --> H[Projections]
    H --> I[Analytics DB]
```

### 7.2. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```go
package main

// todo
```

### 7.3. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

<img src="./static/diagrams/es-cqrs-2.svg" alt="es_cqrs_2_overview">

```sequence
sequenceDiagram
    participant Client
    participant CommandAPI
    participant CommandHandler
    participant EventStore
    participant EventProcessor
    participant ReadModel
    participant QueryAPI

    Client->>CommandAPI: POST /orders (Command)
    CommandAPI->>CommandHandler: CreateOrderCommand
    CommandHandler->>EventStore: Append Events[OrderCreated]
    EventStore-->>CommandHandler: Success
    CommandHandler-->>CommandAPI: 202 Accepted
    CommandAPI-->>Client: 202 Accepted

    loop Async Processing
        EventProcessor->>EventStore: Poll New Events
        EventStore-->>EventProcessor: OrderCreatedEvent
        EventProcessor->>ReadModel: Update Projection
        EventProcessor->>ReadModel: Update MaterializedView
    end

    Client->>QueryAPI: GET /orders/{id} (Query)
    QueryAPI->>ReadModel: GetOrderView
    ReadModel-->>QueryAPI: OrderView
    QueryAPI-->>Client: 200 OK (DTO)
```

### 7.4. –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã:

> 1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É:
>
>    `Client ‚Üí CommandAPI: POST /orders {items: [...]}`
> 2. Command API –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É:
>
>    `CommandAPI ‚Üí CommandHandler: CreateOrderCommand`
> 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è:
>
>    `CommandHandler ‚Üí EventStore: Append [OrderCreatedEvent]`
> 4. EventStore –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å:
>
>    `EventStore ‚Üí CommandHandler: Success`
> 5. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
>
>    `CommandHandler ‚Üí CommandAPI ‚Üí Client: 202 Accepted`
> 6. –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π:
>    - **EventProcessor** –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç **EventStore**
>    - –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (`OrderCreatedEvent`)
>    - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ–µ–∫—Ü–∏–∏ –≤ **ReadModel**
> 7. –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
>
>    `Client ‚Üí QueryAPI: GET /orders/123`
> 8. Query API –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ ReadModel:
>
>    `QueryAPI ‚Üí ReadModel: GetOrderView(123)`
> 9. –î–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É:
>
>    `ReadModel ‚Üí QueryAPI ‚Üí Client: OrderViewDTO`

### 7.5. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ—Ç–æ–∫–∞:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è:**
    - –ó–∞–ø–∏—Å—å –∏–¥–µ—Ç —á–µ—Ä–µ–∑ Command Stack (–ª–µ–≤–∞—è —á–∞—Å—Ç—å)
    - –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Query Stack (–ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å)

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ReadModel –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
    - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—å—é –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é —á—Ç–µ–Ω–∏—è (Eventual Consistency)
3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
    - `EventStore` - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kafka+PostgreSQL)
    - `EventProcessor` - –ø–æ–¥–ø–∏—Å—á–∏–∫ –Ω–∞ —Å–æ–±—ã—Ç–∏—è (Consumer)
    - `ReadModel` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —á—Ç–µ–Ω–∏—è (MongoDB/Elasticsearch)

### 7.6. –¢–∏–ø–æ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:

<img src="./static/diagrams/es-cqrs-latency.svg" alt="es_cqrs_3_overview">

```timeline
timeline
    title –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
    section –ó–∞–ø–∏—Å—å
    Command : 0 ms
    Event Store : 50 ms
    ReadModel Update : 100-500 ms
    section –ß—Ç–µ–Ω–∏–µ
    Query : –ü–æ—Å–ª–µ 500 ms (strong consistency)
```

## 8. –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

| –ö—Ä–∏—Ç–µ—Ä–∏–π               | SAGA                | Event Sourcing      | CQRS                | ES+CQRS             |
|------------------------|---------------------|---------------------|---------------------|---------------------|
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å**          | –ù–∏–∑–∫–∞—è              | –í—ã—Å–æ–∫–∞—è             | –°—Ä–µ–¥–Ω—è—è             | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è       |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** |                     |                     |                     |                     |
| - –ó–∞–ø–∏—Å—å               | –°—Ä–µ–¥–Ω—è—è             | –ù–∏–∑–∫–∞—è              | –°—Ä–µ–¥–Ω—è—è             | –°—Ä–µ–¥–Ω—è—è             |
| - –ß—Ç–µ–Ω–∏–µ               | –°—Ä–µ–¥–Ω—è—è             | –ù–∏–∑–∫–∞—è              | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è       | –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è         |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**   | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞          | –û—Ç–ª–∏—á–Ω–∞—è            | –û—Ç–ª–∏—á–Ω–∞—è            | –ù–∞–∏–ª—É—á—à–∞—è           |
| **–ì–∏–±–∫–æ—Å—Ç—å**           | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞          | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è        | –í—ã—Å–æ–∫–∞—è             | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è        |
| **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**  | –ù–µ—Ç                 | –ü–æ–ª–Ω–∞—è              | –ß–∞—Å—Ç–∏—á–Ω–∞—è           | –ü–æ–ª–Ω–∞—è              |
| **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**    | Eventual            | Strong              | Strong              | Strong              |
| **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**        | –ù–∏–∑–∫–∞—è              | –í—ã—Å–æ–∫–∞—è             | –ù–∏–∑–∫–∞—è (—á—Ç–µ–Ω–∏–µ)     | –°—Ä–µ–¥–Ω—è—è             |
| **–û–±—ä–µ–º –∫–æ–¥–∞**         | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π         | –ë–æ–ª—å—à–æ–π             | –£–º–µ—Ä–µ–Ω–Ω—ã–π           | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π        |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**      | –ü—Ä–æ—Å—Ç—ã–µ workflows   | –ê—É–¥–∏—Ç/–∞–Ω–∞–ª–∏—Ç–∏–∫–∞     | –û—Ç—á–µ—Ç—ã              | –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã |

## 9. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

1. –°—Ç–∞—Ä—Ç–∞–ø—ã: SAGA + Circuit Breaker
2. –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã: –î–æ–±–∞–≤–∏—Ç—å Event Sourcing –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
3. –°–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: –ü–æ–ª–Ω—ã–π ES+CQRS —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ü–∏—è–º–∏

<img src="./static/diagrams/recommendations.svg" alt="es_cqrs_overview">

```graph
graph TD
    A[–í—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã] --> B{–ö—Ä–∏—Ç–∏—á–Ω–∞ –ª–∏ –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è?}
    B -->|–î–∞| C{–¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è?}
    C -->|–î–∞| D[ES+CQRS]
    C -->|–ù–µ—Ç| E[–ß–∏—Å—Ç—ã–π Event Sourcing]
    B -->|–ù–µ—Ç| F[–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è SAGA]
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠–≤–æ–ª—é—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è:

1. –ù–∞—á–Ω–∏—Ç–µ —Å **SAGA** –¥–ª—è –±–∞–∑–æ–≤–æ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
2. –î–æ–±–∞–≤—å—Ç–µ **Event Sourcing** –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤
3. –í–Ω–µ–¥—Ä–∏—Ç–µ **CQRS** –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ **ES+CQRS** –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

> **–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:** –í—ã–±–∏—Ä–∞–π—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–∞—à–∏–º —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º, –∞ –Ω–µ —Ç—Ä–µ–Ω–¥–∞–º.